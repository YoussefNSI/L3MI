<?php header("Content-Type: application/json; charset=UTF-8");session_start();if(!key_exists("file",$_SESSION)){$d0="./data/communes.csv";$t1=file_get_contents($d0);$v2=["CDC","CHEFLIEU","REG","DEP","COM","AR","CT","TNCC","ARTMAJ","NCC","ARTMIN","NCCENR"];$n3=array_flip($v2);$y4=[];$p5=1;if(($q6=fopen($d0,"r"))!==FALSE){while(($i7=fgetcsv($q6,1000,";"))!==FALSE){if($p5!==1){$k8=count($i7);$c9=[];for($n10=0;$n10<$k8;$n10++){if($n10===$n3["REG"]||$n10===$n3["DEP"]||$n10===$n3["NCCENR"]){$c9[$v2[$n10]]=$i7[$n10];}}$y4[]=$c9;$_SESSION["file"]=$y4;}else{++$p5;}}fclose($q6);}}else{$y4=$_SESSION["file"];}$z11="région";$r12="bloc";if(!key_exists($z11,$_POST)){throw new g13("pas de clé 'région' communiquée");}if(!key_exists($r12,$_POST)){throw new g13("pas de clé 'bloc' communiquée");}$q14=$_POST[$z11];$y15=(int)$_POST[$r12];$e16=100;$c17=($y15-1)*$e16;$w18=$e16;$k19=array_filter($y4,fn($c9)=>$c9["REG"]===$q14);$k19=array_map(fn($c9)=>["région"=>$c9["REG"],"département"=>$c9["DEP"],"nom"=>$c9["NCCENR"]],$k19);$k19=array_slice(array_values($k19),$c17,$w18);echo json_encode($k19);?>